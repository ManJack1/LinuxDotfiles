document.querySelectorAll("[data-content]").forEach((t=>{t.dataset.content=chrome.i18n.getMessage(t.dataset.content)})),"ltr"===chrome.i18n.getMessage("@@bidi_dir")?document.body.setAttribute("dir","ltr"):document.body.setAttribute("dir","rtl"),document.querySelector("#newVersion").textContent=chrome.i18n.getMessage("newVersion"),document.querySelector("#versionNumber").textContent=chrome.runtime.getManifest().version,document.querySelector("#updateButton").addEventListener("click",(()=>{document.querySelector("#updateBar").style.display="none",chrome.storage.sync.set({updateBarStatus:!1})})),chrome.storage.sync.get(["single","singleSubtitleStyle","dualSubtitlesStyle","customStyle","common","updateBarStatus"],(async({single:t,singleSubtitleStyle:e,dualSubtitlesStyle:o,customStyle:r,common:n,updateBarStatus:s})=>{s&&document.querySelector("#updateBar").style.removeProperty("display");const c=t=>chrome.storage.local.set(t),a=await new Promise((t=>{chrome.runtime.onMessage.addListener(((e,{tab:o})=>{"requestSameLang"===e.type&&o.active&&t(e.value)})),chrome.storage.local.set({requestSameLang:Date.now()}),setTimeout((()=>t(!1)),80)})),l=document.querySelector("#ytButBox"),i=document.querySelector("#subtitleMode"),d=l.querySelectorAll("button"),u=t=>{d.forEach((t=>t.classList.add("opacity-40"))),"ltr"===chrome.i18n.getMessage("@@bidi_dir")?(d[0].style.setProperty("transform",`translateX(${t}px)`),d[1].style.setProperty("transform",`translateX(-${t}px)`)):(d[0].style.setProperty("transform",`translateX(-${t}px)`),d[1].style.setProperty("transform",`translateX(${t}px)`)),setTimeout((()=>d.forEach((t=>t.classList.remove("opacity-40")))),140)},y=chrome.i18n.getMessage("videoButton");d[0].querySelector("span").textContent=y,d[0].setAttribute("title",y);const S=chrome.i18n.getMessage("translateButton");d[1].querySelector("span").textContent=S,d[1].setAttribute("title",S);const g=[...d].map((t=>t.offsetWidth)),m=Math.max(...g);d.forEach((t=>t.style.setProperty("width",`${m}px`)));const h=l.offsetWidth-m;2===o.one.rowStart&&("ltr"===chrome.i18n.getMessage("@@bidi_dir")?(d[0].style.setProperty("transform",`translateX(${h}px)`),d[1].style.setProperty("transform",`translateX(${-h}px)`)):(d[0].style.setProperty("transform",`translateX(${-h}px)`),d[1].style.setProperty("transform",`translateX(${h}px)`))),setTimeout((()=>d.forEach((t=>t.classList.add("ytTransition")))),60),document.querySelector("#ytSwapPosition").addEventListener("click",(()=>{1===o.one.rowStart?(u(h),o.one.rowStart=2,o.two.rowStart=1):(u(0),o.one.rowStart=1,o.two.rowStart=2),chrome.storage.sync.set({dualSubtitlesStyle:o}),c({dualSubtitlesStyle:o})})),o.one.check?d[0].setAttribute("id","ytButtonCheck"):d[1].setAttribute("id","ytButtonCheck");const k=(t,e)=>{const r=l.querySelector("#ytButtonCheck");r!==t.currentTarget&&(r.removeAttribute("id"),t.currentTarget.setAttribute("id","ytButtonCheck"),0===e?(o.one.check=!0,o.two.check=!1):(o.one.check=!1,o.two.check=!0),chrome.storage.sync.set({dualSubtitlesStyle:o},G))};d[0].addEventListener("click",(t=>k(t,0))),d[1].addEventListener("click",(t=>k(t,1)));const p=document.querySelector("#ytList"),f=document.querySelector("#ytFontButton"),b=f.querySelector("#ytDownicon"),w=p.querySelector("#ytItems"),L=p.querySelector("#ytClear"),C=p.querySelector("#ytInputFont");f.addEventListener("click",(t=>{if(p.offsetWidth)f.classList.remove("bg-ytLightBlue","dark:bg-ytDarkBg"),b.classList.remove("opacity-100"),p.classList.add("hidden"),C.value="",w.querySelectorAll("div.hidden").forEach((t=>t.classList.remove("hidden")));else{p.classList.remove("hidden"),f.classList.add("bg-ytLightBlue","dark:bg-ytDarkBg"),b.classList.add("opacity-100"),C.focus();const t=w.querySelector("#ytCheck");t&&t.scrollIntoView({block:"center"})}t.stopPropagation()})),w.addEventListener("click",(r=>{if(r.target===w)return;p.classList.add("hidden"),C.value="",w.querySelectorAll("div.hidden").forEach((t=>t.classList.remove("hidden")));const n=w.querySelector("#ytCheck");n!==r.target&&(n&&n.removeAttribute("id"),r.target.setAttribute("id","ytCheck"),f.querySelector("span").textContent=r.target.innerText,t||a?(e.one.fontFamily=r.target.dataset.fontid,chrome.storage.sync.set({singleSubtitleStyle:e}),c({singleSubtitleStyle:e})):(o.one.check?o.one.fontFamily=r.target.dataset.fontid:o.two.fontFamily=r.target.dataset.fontid,chrome.storage.sync.set({dualSubtitlesStyle:o}),c({dualSubtitlesStyle:o})))})),L.addEventListener("click",(()=>{C.value="",C.focus(),w.querySelectorAll("div.hidden").forEach((t=>t.classList.remove("hidden")))})),C.addEventListener("keyup",(()=>{w.querySelectorAll("div").forEach((t=>{t.innerText.toLowerCase().includes(C.value.toLowerCase())?t.classList.remove("hidden"):t.classList.add("hidden")}))})),window.addEventListener("click",(t=>{p.contains(t.target)||(f.classList.remove("bg-ytLightBlue","dark:bg-ytDarkBg"),b.classList.remove("opacity-100"),p.classList.add("hidden"),C.value="",w.querySelectorAll("div.hidden").forEach((t=>t.classList.remove("hidden"))))}));const x=document.querySelector("#ytSizeTip"),v=x.querySelector("#ytSizeTipText"),E=document.querySelector("#ytInputSize");E.addEventListener("input",(()=>{v.textContent=E.value;const r=(E.value-E.min)/(E.max-E.min)*100;"ltr"===chrome.i18n.getMessage("@@bidi_dir")?(x.style.setProperty("left",`${r}%`),E.style.setProperty("background-image",`linear-gradient(to right, #1c74f8 0%, #1c74f8 ${r}%, #1c74f861 ${r}%, #1c74f861 100%)`)):(x.style.setProperty("right",`${r}%`),E.style.setProperty("background-image",`linear-gradient(to left, #1c74f8 0%, #1c74f8 ${r}%, #1c74f861 ${r}%, #1c74f861 100%)`)),t||a?(e.one.fontSize=E.value,c({singleSubtitleStyle:e})):(o.one.check?o.one.fontSize=E.value:o.two.fontSize=E.value,c({dualSubtitlesStyle:o}))})),E.addEventListener("change",(()=>{t||a?chrome.storage.sync.set({singleSubtitleStyle:e}):chrome.storage.sync.set({dualSubtitlesStyle:o})}));const q=document.querySelector("#ytSpaceTip"),A=q.querySelector("#ytSpaceTipText"),P=document.querySelector("#ytInputSpace");P.addEventListener("input",(()=>{A.textContent=P.value;const r=(P.value-P.min)/(P.max-P.min)*100;"ltr"===chrome.i18n.getMessage("@@bidi_dir")?(q.style.setProperty("left",`${r}%`),P.style.setProperty("background-image",`linear-gradient(to right, #1c74f8 0%, #1c74f8 ${r}%, #1c74f861 ${r}%, #1c74f861 100%)`)):(q.style.setProperty("right",`${r}%`),P.style.setProperty("background-image",`linear-gradient(to left, #1c74f8 0%, #1c74f8 ${r}%, #1c74f861 ${r}%, #1c74f861 100%)`)),t||a?(e.rowGap=P.value,c({singleSubtitleStyle:e})):(o.rowGap=P.value,c({dualSubtitlesStyle:o}))})),P.addEventListener("change",(()=>{t||a?chrome.storage.sync.set({singleSubtitleStyle:e}):chrome.storage.sync.set({dualSubtitlesStyle:o})}));const X=Pickr.create({el:"#ytColor",container:"#ytColor",theme:"nano",appClass:"ytColorPicker",useAsButton:!0,default:"#c084fc",swatches:n.color,defaultRepresentation:"HEX",position:"top-start",components:{preview:!0,opacity:!0,hue:!0,interaction:{input:!0}}});document.querySelector("#ytColor .ytColorPicker").addEventListener("click",(t=>t.stopPropagation()));const B=document.querySelector("#ytColor #colorBlock"),T=document.querySelector("#ytColor #colorText");X.on("change",(r=>{B.style.background=r.toHEXA().toString(),T.textContent=r.toHEXA().toString().toLowerCase(),t||a?(e.one.color=r.toHEXA().toString().toLowerCase(),c({singleSubtitleStyle:e})):(o.one.check?o.one.color=r.toHEXA().toString().toLowerCase():o.two.color=r.toHEXA().toString().toLowerCase(),c({dualSubtitlesStyle:o}))})).on("changestop",(()=>{t||a?chrome.storage.sync.set({singleSubtitleStyle:e}):chrome.storage.sync.set({dualSubtitlesStyle:o})})).on("swatchselect",(r=>{t||a?(e.one.color=r.toHEXA().toString().toLowerCase(),chrome.storage.sync.set({singleSubtitleStyle:e})):(o.one.check?o.one.color=r.toHEXA().toString().toLowerCase():o.two.color=r.toHEXA().toString().toLowerCase(),chrome.storage.sync.set({dualSubtitlesStyle:o}))})),X.on("hide",(t=>{const e=t.getColor().toHEXA().toString().toLowerCase(),o=t._swatchColors.map((t=>t.color.toHEXA().toString().toLowerCase())),r=[...new Set([e].concat(o))].slice(0,7);setTimeout((()=>{Object.keys(o).reverse().forEach((t=>X.removeSwatch(t))),r.forEach((t=>{X.addSwatch(t)}))}),200),n.color=r,chrome.storage.sync.set({common:n})}));const H=Pickr.create({el:"#ytBackground",container:"#ytBackground",theme:"nano",appClass:"ytBackgroundPicker",useAsButton:!0,default:"#06b6d4",swatches:n.background,defaultRepresentation:"HEX",position:"top-start",components:{preview:!0,opacity:!0,hue:!0,interaction:{input:!0}}});document.querySelector("#ytBackground .ytBackgroundPicker").addEventListener("click",(t=>t.stopPropagation()));const $=document.querySelector("#ytBackground #backgroundBlock"),M=document.querySelector("#ytBackground #backgroundText");H.on("change",(r=>{$.style.background=r.toHEXA().toString(),M.textContent=r.toHEXA().toString().toLowerCase(),t||a?(e.one.background=r.toHEXA().toString().toLowerCase(),c({singleSubtitleStyle:e})):(o.one.check?o.one.background=r.toHEXA().toString().toLowerCase():o.two.background=r.toHEXA().toString().toLowerCase(),c({dualSubtitlesStyle:o}))})).on("changestop",(()=>{t||a?chrome.storage.sync.set({singleSubtitleStyle:e}):chrome.storage.sync.set({dualSubtitlesStyle:o})})).on("swatchselect",(r=>{t||a?(e.one.background=r.toHEXA().toString().toLowerCase(),chrome.storage.sync.set({singleSubtitleStyle:e})):(o.one.check?o.one.background=r.toHEXA().toString().toLowerCase():o.two.background=r.toHEXA().toString().toLowerCase(),chrome.storage.sync.set({dualSubtitlesStyle:o}))})),H.on("hide",(t=>{const e=t.getColor().toHEXA().toString().toLowerCase(),o=t._swatchColors.map((t=>t.color.toHEXA().toString().toLowerCase())),r=[...new Set([e].concat(o))].slice(0,7);setTimeout((()=>{Object.keys(o).reverse().forEach((t=>H.removeSwatch(t))),r.forEach((t=>{H.addSwatch(t)}))}),200),n.background=r,chrome.storage.sync.set({common:n})}));const z=Pickr.create({el:"#ytTextStroke",container:"#ytTextStroke",theme:"nano",appClass:"ytTextStrokePicker",useAsButton:!0,default:"#c084fc",swatches:n.stroke,defaultRepresentation:"HEX",position:"top-start",components:{preview:!0,opacity:!0,hue:!0,interaction:{input:!0}}});document.querySelector("#ytTextStroke .ytTextStrokePicker").addEventListener("click",(t=>t.stopPropagation()));const F=document.querySelector("#ytTextStroke #textStrokeBlock"),_=document.querySelector("#ytTextStroke #textStrokeText");z.on("change",(r=>{F.style.background=r.toHEXA().toString(),_.textContent=r.toHEXA().toString().toLowerCase(),t||a?(e.one.textStroke=r.toHEXA().toString().toLowerCase(),c({singleSubtitleStyle:e})):(o.one.check?o.one.textStroke=r.toHEXA().toString().toLowerCase():o.two.textStroke=r.toHEXA().toString().toLowerCase(),c({dualSubtitlesStyle:o}))})).on("changestop",(()=>{t||a?chrome.storage.sync.set({singleSubtitleStyle:e}):chrome.storage.sync.set({dualSubtitlesStyle:o})})).on("swatchselect",(r=>{t||a?(e.one.textStroke=r.toHEXA().toString().toLowerCase(),chrome.storage.sync.set({singleSubtitleStyle:e})):(o.one.check?o.one.textStroke=r.toHEXA().toString().toLowerCase():o.two.textStroke=r.toHEXA().toString().toLowerCase(),chrome.storage.sync.set({dualSubtitlesStyle:o}))})),z.on("hide",(t=>{const e=t.getColor().toHEXA().toString().toLowerCase(),o=t._swatchColors.map((t=>t.color.toHEXA().toString().toLowerCase())),r=[...new Set([e].concat(o))].slice(0,7);setTimeout((()=>{Object.keys(o).reverse().forEach((t=>z.removeSwatch(t))),r.forEach((t=>{z.addSwatch(t)}))}),200),n.stroke=r,chrome.storage.sync.set({common:n})}));const I=document.querySelector("#ytSwitch");I.checked=r,r||[f,E,document.querySelector("#ytColor"),document.querySelector("#ytBackground"),document.querySelector("#ytTextStroke")].forEach((t=>{t.disabled=!0,t.classList.add("cursor-not-allowed")})),setTimeout((()=>document.querySelector("#ytSwitchParent div div").classList.add("transition")),60),I.addEventListener("change",(t=>{chrome.storage.sync.set({customStyle:t.target.checked}),c({customStyle:t.target.checked}),t.target.checked?[f,E,document.querySelector("#ytColor"),document.querySelector("#ytBackground"),document.querySelector("#ytTextStroke")].forEach((t=>{t.disabled=!1,t.classList.remove("cursor-not-allowed")})):[f,E,document.querySelector("#ytColor"),document.querySelector("#ytBackground"),document.querySelector("#ytTextStroke")].forEach((t=>{t.disabled=!0,t.classList.add("cursor-not-allowed")}))}));const G=()=>{let r={};if(t||a){const{one:t}=e;r=t,l.style.setProperty("display","none"),document.querySelector("#ytSpaceBox").style.setProperty("display","none"),i.textContent=chrome.i18n.getMessage("singleMode")}else{const{one:t,two:e,rowGap:n}=o;r=t.check?t:e,r.rowGap=n,i.textContent=chrome.i18n.getMessage("dualMode")}f.querySelector("#fontText").textContent=r.fontFamily,chrome.fontSettings.getFontList((t=>{document.querySelector("#ytItems").textContent="";const e=t.map((({fontId:t,displayName:e})=>{const o=document.createElement("div");return o.textContent=e,o.dataset.fontid=t,o.setAttribute("title",e),r.fontFamily===t&&(o.setAttribute("id","ytCheck"),f.querySelector("#fontText").textContent=e),o.classList.add("truncate","px-2","text-xs","text-[#000000db]","h-[31px]","leading-[31px]","hover:bg-[#eee]","active:bg-[#e3f2fd]","cursor-pointer","dark:text-ytDarkIcon","dark:hover:bg-[#4d4d4de5]","dark:active:bg-[#6d6d6de5]"),o}));document.querySelector("#ytItems").append(...e)})),E.value=r.fontSize,v.textContent=r.fontSize;const n=(r.fontSize-E.min)/(E.max-E.min)*100;"ltr"===chrome.i18n.getMessage("@@bidi_dir")?(x.style.setProperty("left",`${n}%`),x.classList.add("-translate-x-1/2"),E.style.setProperty("background-image",`linear-gradient(to right, #1c74f8 0%, #1c74f8 ${n}%, #1c74f861 ${n}%, #1c74f861 100%)`)):(x.style.setProperty("right",`${n}%`),x.classList.add("translate-x-1/2"),E.style.setProperty("background-image",`linear-gradient(to left, #1c74f8 0%, #1c74f8 ${n}%, #1c74f861 ${n}%, #1c74f861 100%)`)),P.value=r.rowGap,A.textContent=r.rowGap;const s=(r.rowGap-P.min)/(P.max-P.min)*100;"ltr"===chrome.i18n.getMessage("@@bidi_dir")?(q.style.setProperty("left",`${s}%`),q.classList.add("-translate-x-1/2"),P.style.setProperty("background-image",`linear-gradient(to right, #1c74f8 0%, #1c74f8 ${s}%, #1c74f861 ${s}%, #1c74f861 100%)`)):(q.style.setProperty("right",`${s}%`),q.classList.add("translate-x-1/2"),P.style.setProperty("background-image",`linear-gradient(to left, #1c74f8 0%, #1c74f8 ${s}%, #1c74f861 ${s}%, #1c74f861 100%)`)),B.style.background=r.color,T.textContent=r.color,setTimeout((()=>{X.setColor(r.color)}),180),$.style.background=r.background,M.textContent=r.background,setTimeout((()=>{H.setColor(r.background)}),180),F.style.background=r.textStroke,_.textContent=r.textStroke,setTimeout((()=>{z.setColor(r.textStroke)}),180)};G(),document.querySelector("#resetStyle").addEventListener("click",(()=>{const t=document.querySelector("#resetStyleSvg");t.classList.add("rotate"),setTimeout((()=>t.classList.remove("rotate")),370);const r={fontFamily:"Roboto",fontSize:"32",color:"#ffffff",background:"#080808bf",textStroke:"#00000000"};o={one:{...o.one,...r},two:{...o.two,...r},rowGap:0},e={one:{fontFamily:"Roboto",fontSize:"32",color:"#ffffff",background:"#080808bf",textStroke:"#00000000"}},chrome.storage.sync.set({dualSubtitlesStyle:o,singleSubtitleStyle:e},G),c({dualSubtitlesStyle:o,singleSubtitleStyle:e})}))}));